<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Reaction & Comment Tool By: Dars</title>
    <style>
        /* Base styles - apply to all screen sizes */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f2f5;
            font-family: Arial, sans-serif;
            box-sizing: border-box; /* Ensures padding and border are included in the element's total width and height */
        }
        h2 {
            color: #1877f2;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .nav {
            display: flex;
            justify-content: center;
            background: #1877f2;
            padding: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* Allow buttons to wrap to the next line on smaller screens */
        }
        .nav button {
            background: white;
            border: none;
            padding: 10px 20px;
            margin: 5px; /* Adjust margin for wrapped buttons */
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: #1877f2;
            transition: background-color 0.3s ease;
            flex-grow: 1; /* Allow buttons to grow and fill space */
            max-width: 200px; /* Limit button width on larger screens */
        }
        .nav button.active {
            background: #145dbf;
            color: white;
        }
        .container {
            max-width: 900px;
            width: 90%; /* Use percentage for fluid width */
            background: white;
            padding: 20px 30px;
            margin: 20px auto;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }
        label {
            display: block;
            margin-top: 18px;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input[type="text"]:focus,
        input[type="file"]:focus,
        select:focus,
        textarea:focus {
            border-color: #1877f2;
            outline: none;
        }
        button {
            background-color: #1877f2;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 25px;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            width: auto; /* Allow buttons to size based on content */
            display: inline-block; /* For proper spacing with other buttons */
            margin-right: 10px; /* Space between buttons */
        }
        button:last-of-type {
            margin-right: 0; /* No margin on the last button */
        }
        button:hover {
            background-color: #145dbf;
        }
        .clear-log-btn {
            background-color: #888;
            margin-top: 15px;
        }
        .clear-log-btn:hover {
            background-color: #666;
        }
        .log-box {
            background: #f6f6f6;
            padding: 15px;
            border-radius: 5px;
            margin-top: 30px;
            font-size: 14px;
            min-height: 50px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #eee;
            box-sizing: border-box;
        }
        .log-box strong {
            display: block;
            margin-bottom: 10px;
            color: #555;
        }
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-entry.success { color: green; }
        .log-entry.error { color: red; }
        .log-entry.info { color: gray; }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        /* Styles for dynamic link/file path rows */
        .dynamic-entry-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            margin-top: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
            flex-wrap: wrap; /* Allow columns to wrap on smaller screens */
        }
        .dynamic-entry-row:last-of-type {
            border-bottom: none;
        }
        .dynamic-entry-column {
            flex: 1;
            min-width: 250px; /* Ensure columns don't get too small before wrapping */
            box-sizing: border-box;
        }
        .dynamic-entry-column label {
            margin-top: 0;
            margin-bottom: 8px;
        }
        .remove-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 0;
            width: auto;
            white-space: nowrap;
            align-self: center;
            height: 40px;
            line-height: 24px;
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        .remove-button:hover {
            background-color: #c82333;
        }
        .add-button {
            background-color: #28a745;
            margin-top: 30px;
            margin-right: 10px; /* Ensure spacing if there are multiple action buttons */
        }
        .add-button:hover {
            background-color: #218838;
        }

        /* --- Media Queries for Mobile Responsiveness --- */
        @media (max-width: 768px) {
            .container {
                width: 95%; /* Make container slightly wider on small screens */
                padding: 15px; /* Reduce padding */
            }
            h2 {
                font-size: 1.5em; /* Slightly smaller heading */
            }
            .nav {
                flex-direction: column; /* Stack navigation buttons vertically */
                padding: 10px 5px;
            }
            .nav button {
                width: calc(100% - 10px); /* Full width minus margin */
                margin: 5px auto; /* Center buttons */
                max-width: unset; /* Remove max-width on mobile */
            }
            button {
                display: block; /* Make action buttons full width */
                width: 100%;
                margin: 15px 0 0 0; /* Adjust margins for stacked buttons */
                padding: 10px 15px;
                box-sizing: border-box;
            }
            .add-button {
                margin-top: 20px; /* Slightly less margin for add button */
            }
            .clear-log-btn {
                margin-top: 10px; /* Slightly less margin for clear log button */
            }
            .dynamic-entry-row {
                flex-direction: column; /* Stack input fields and remove button vertically */
                gap: 10px; /* Reduce gap between stacked elements */
                padding-bottom: 10px;
            }
            .dynamic-entry-column {
                min-width: unset; /* Remove min-width on mobile */
                width: 100%; /* Make columns full width */
            }
            .remove-button {
                width: 100%; /* Make remove button full width */
                height: auto; /* Allow height to adjust */
                padding: 10px;
                line-height: normal;
                margin-top: 5px; /* Small margin after the input field */
            }
            .log-box {
                margin-top: 20px; /* Reduce margin */
            }
        }

        /* Flash message styling (already present, just ensuring it looks good) */
        .flash-messages {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }
        .flash-messages li {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

    </style>
</head>
<body>
    <h2>üì£ Facebook Engagement Bot V1</h2>

    <div class="nav">
        <button id="navReaction" class="active">‚ù§Ô∏è Reaction Tool</button>
        <button id="navComment">üí¨ Comment Tool</button>
    </div>

    <div id="reactionPage" class="page active">
        <div class="container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <ul class="flash-messages">
                        {% for category, message in messages %}
                            <li class="{{ category }}">{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endwith %}

            <form action="{{ url_for('send_reaction') }}" method="post" enctype="multipart/form-data">
                <label for="token_file">üìÑ Load Access Tokens from File (one per line)</label>
                <input type="file" id="token_file" name="token_file" accept=".txt" />

                <label for="current_reaction_token">üîë Access Token (currently used)</label>
                <input type="text" id="current_reaction_token" placeholder="Loaded access token" readonly>

                <div id="reaction_entries_container">
                    </div>

                <button type="button" class="add-button" onclick="addReactionEntry()">‚ûï Add Another Post</button>
                <button type="submit">‚úÖ Send Reactions</button>
                <button type="button" class="clear-log-btn" onclick="clearLog('reaction')">üóëÔ∏è Clear Reaction History</button>

                <div class="log-box" id="reaction_log_box">
                    <strong>üóÇÔ∏è Reaction History:</strong>
                    <div id="reaction_log_content">
                        {% for log in reaction_logs %}
                            {{ log }}<br>
                        {% endfor %}
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="commentPage" class="page">
        <div class="container">
            <form action="{{ url_for('send_comment') }}" method="post" enctype="multipart/form-data">
                <label for="comment_token_file">üìÑ Load Access Tokens from File (one per line)</label>
                <input type="file" id="comment_token_file" name="comment_token_file" accept=".txt" />

                <label for="current_comment_token">üîë Access Token (currently used)</label>
                <input type="text" id="current_comment_token" placeholder="Loaded access token" readonly>

                <div id="comment_entries_container">
                    </div>

                <button type="button" class="add-button" onclick="addCommentEntry()">‚ûï Add Another Post & Comment File</button>
                <button type="submit">‚úÖ Send Comments</button>
                <button type="button" class="clear-log-btn" onclick="clearLog('comment')">üóëÔ∏è Clear Comment History</button>

                <div class="log-box" id="comment_log_box">
                    <strong>üóÇÔ∏è Comment History:</strong>
                    <div id="comment_log_content">
                        {% for log in comment_logs %}
                            {{ log }}<br>
                        {% endfor %}
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Navigation Logic ---
        document.getElementById('navReaction').addEventListener('click', () => switchPage('reaction'));
        document.getElementById('navComment').addEventListener('click', () => switchPage('comment'));

        function switchPage(page) {
            document.getElementById('reactionPage').classList.remove('active');
            document.getElementById('commentPage').classList.remove('active');
            document.getElementById('navReaction').classList.remove('active');
            document.getElementById('navComment').classList.remove('active');

            if (page === 'reaction') {
                document.getElementById('reactionPage').classList.add('active');
                document.getElementById('navReaction').classList.add('active');
            } else {
                document.getElementById('commentPage').classList.add('active');
                document.getElementById('navComment').classList.add('active');
            }
        }

        // --- Shared Log Function ---
        function addLog(message, type, logType) {
            const logContainer = logType === 'reaction' ? document.getElementById('reaction_log_content') : document.getElementById('comment_log_content');
            const entry = document.createElement('div');
            entry.classList.add('log-entry');
            if (type) entry.classList.add(type);
            entry.textContent = message;
            logContainer.appendChild(entry);
            // Scroll to bottom
            const parentBox = logType === 'reaction' ? document.getElementById('reaction_log_box') : document.getElementById('comment_log_box');
            parentBox.scrollTop = parentBox.scrollHeight;
        }

        function clearLog(logType) {
            const logContainer = logType === 'reaction' ? document.getElementById('reaction_log_content') : document.getElementById('comment_log_content');
            logContainer.innerHTML = '';
            addLog(`Log cleared for ${logType} tool.`, 'info', logType);
        }

        // --- Access Token Loading Logic ---
        let reactionAccessTokens = [];
        let commentAccessTokens = [];

        document.getElementById('token_file').addEventListener('change', function () {
            loadAccessTokens(this, 'reaction');
        });

        document.getElementById('comment_token_file').addEventListener('change', function () {
            loadAccessTokens(this, 'comment');
        });

        function loadAccessTokens(fileInput, type) {
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const tokens = e.target.result.split(/\r?\n/).map(line => line.trim()).filter(line => line.length > 0);
                if (type === 'reaction') {
                    reactionAccessTokens = tokens;
                    if (reactionAccessTokens.length > 0) {
                        document.getElementById('current_reaction_token').value = reactionAccessTokens[0];
                        addLog(`Loaded ${reactionAccessTokens.length} access tokens for Reaction Tool.`, 'info', 'reaction');
                    } else {
                        addLog('No access tokens found in the file for Reaction Tool.', 'error', 'reaction');
                    }
                } else {
                    commentAccessTokens = tokens;
                    if (commentAccessTokens.length > 0) {
                        document.getElementById('current_comment_token').value = commentAccessTokens[0];
                        addLog(`Loaded ${commentAccessTokens.length} access tokens for Comment Tool.`, 'info', 'comment');
                    } else {
                        addLog('No access tokens found in the file for Comment Tool.', 'error', 'comment');
                    }
                }
            };
            reader.readAsText(file);
        }


        // --- Dynamic Entry Management (Reaction) ---
        function addReactionEntry() {
            const container = document.getElementById('reaction_entries_container');
            const newEntry = document.createElement('div');
            newEntry.className = 'dynamic-entry-row';
            newEntry.innerHTML = `
                <div class="dynamic-entry-column">
                    <label>Facebook Post ID or URL:</label>
                    <input type="text" name="reaction_link_input[]" placeholder="e.g., 1234567890 or https://www.facebook.com/..." required>
                </div>
                <div class="dynamic-entry-column">
                    <label>Reaction Type:</label>
                    <select name="reaction_type[]">
                        <option value="LIKE">üëç Like</option>
                        <option value="LOVE">‚ù§Ô∏è Love</option>
                        <option value="HAHA">üòÇ Haha</option>
                        <option value="WOW">üòÆ Wow</option>
                        <option value="SAD">üò¢ Sad</option>
                        <option value="ANGRY">üò° Angry</option>
                        <option value="CARE">ü§ó Care</option>
                    </select>
                </div>
                <button type="button" class="remove-button" onclick="removeEntry(this)">‚ûñ Remove</button>
            `;
            container.appendChild(newEntry);
        }

        // --- Dynamic Entry Management (Comment) ---
        function addCommentEntry() {
            const container = document.getElementById('comment_entries_container');
            const newEntry = document.createElement('div');
            newEntry.className = 'dynamic-entry-row';
            newEntry.innerHTML = `
                <div class="dynamic-entry-column">
                    <label>Facebook Post ID or URL:</label>
                    <input type="text" name="comment_link_input[]" placeholder="e.g., 1234567890 or https://www.facebook.com/..." required>
                </div>
                <div class="dynamic-entry-column">
                    <label>Comment File (One comment per line):</label>
                    <input type="file" name="comment_path_file[]" accept=".txt" required>
                </div>
                <button type="button" class="remove-button" onclick="removeEntry(this)">‚ûñ Remove</button>
            `;
            container.appendChild(newEntry);
        }

        function removeEntry(button) {
            button.closest('.dynamic-entry-row').remove();
        }

        // Add initial rows on page load
        document.addEventListener('DOMContentLoaded', () => {
            addReactionEntry();
            addCommentEntry();
        });
    </script>
</body>
</html>
